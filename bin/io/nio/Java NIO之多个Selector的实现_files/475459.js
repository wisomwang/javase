document.write('<link href="https://code.csdn.net/assets/embed-df3d4903cf8e7d8df1c7eddf8fed1500.css" media="screen" rel="stylesheet" type="text/css" />');
document.write("<div class=\'CODE_snippets\'>\n<div class=\'snippets_cont file_holder\'>\n<div class=\'file_content code\'>\n<div class=\'white\'>\n<table class=\"lines\"><tr><td><pre class=\"line_numbers\" style=\"width:30px\"><a id=\"L1\" href=\"#L1\" rel=\"#L1\"><i class=\"icon-link\"><\/i>  1<\/a>\n<a id=\"L2\" href=\"#L2\" rel=\"#L2\"><i class=\"icon-link\"><\/i>  2<\/a>\n<a id=\"L3\" href=\"#L3\" rel=\"#L3\"><i class=\"icon-link\"><\/i>  3<\/a>\n<a id=\"L4\" href=\"#L4\" rel=\"#L4\"><i class=\"icon-link\"><\/i>  4<\/a>\n<a id=\"L5\" href=\"#L5\" rel=\"#L5\"><i class=\"icon-link\"><\/i>  5<\/a>\n<a id=\"L6\" href=\"#L6\" rel=\"#L6\"><i class=\"icon-link\"><\/i>  6<\/a>\n<a id=\"L7\" href=\"#L7\" rel=\"#L7\"><i class=\"icon-link\"><\/i>  7<\/a>\n<a id=\"L8\" href=\"#L8\" rel=\"#L8\"><i class=\"icon-link\"><\/i>  8<\/a>\n<a id=\"L9\" href=\"#L9\" rel=\"#L9\"><i class=\"icon-link\"><\/i>  9<\/a>\n<a id=\"L10\" href=\"#L10\" rel=\"#L10\"><i class=\"icon-link\"><\/i> 10<\/a>\n<a id=\"L11\" href=\"#L11\" rel=\"#L11\"><i class=\"icon-link\"><\/i> 11<\/a>\n<a id=\"L12\" href=\"#L12\" rel=\"#L12\"><i class=\"icon-link\"><\/i> 12<\/a>\n<a id=\"L13\" href=\"#L13\" rel=\"#L13\"><i class=\"icon-link\"><\/i> 13<\/a>\n<a id=\"L14\" href=\"#L14\" rel=\"#L14\"><i class=\"icon-link\"><\/i> 14<\/a>\n<a id=\"L15\" href=\"#L15\" rel=\"#L15\"><i class=\"icon-link\"><\/i> 15<\/a>\n<a id=\"L16\" href=\"#L16\" rel=\"#L16\"><i class=\"icon-link\"><\/i> 16<\/a>\n<a id=\"L17\" href=\"#L17\" rel=\"#L17\"><i class=\"icon-link\"><\/i> 17<\/a>\n<a id=\"L18\" href=\"#L18\" rel=\"#L18\"><i class=\"icon-link\"><\/i> 18<\/a>\n<a id=\"L19\" href=\"#L19\" rel=\"#L19\"><i class=\"icon-link\"><\/i> 19<\/a>\n<a id=\"L20\" href=\"#L20\" rel=\"#L20\"><i class=\"icon-link\"><\/i> 20<\/a>\n<a id=\"L21\" href=\"#L21\" rel=\"#L21\"><i class=\"icon-link\"><\/i> 21<\/a>\n<a id=\"L22\" href=\"#L22\" rel=\"#L22\"><i class=\"icon-link\"><\/i> 22<\/a>\n<a id=\"L23\" href=\"#L23\" rel=\"#L23\"><i class=\"icon-link\"><\/i> 23<\/a>\n<a id=\"L24\" href=\"#L24\" rel=\"#L24\"><i class=\"icon-link\"><\/i> 24<\/a>\n<a id=\"L25\" href=\"#L25\" rel=\"#L25\"><i class=\"icon-link\"><\/i> 25<\/a>\n<a id=\"L26\" href=\"#L26\" rel=\"#L26\"><i class=\"icon-link\"><\/i> 26<\/a>\n<a id=\"L27\" href=\"#L27\" rel=\"#L27\"><i class=\"icon-link\"><\/i> 27<\/a>\n<a id=\"L28\" href=\"#L28\" rel=\"#L28\"><i class=\"icon-link\"><\/i> 28<\/a>\n<a id=\"L29\" href=\"#L29\" rel=\"#L29\"><i class=\"icon-link\"><\/i> 29<\/a>\n<a id=\"L30\" href=\"#L30\" rel=\"#L30\"><i class=\"icon-link\"><\/i> 30<\/a>\n<a id=\"L31\" href=\"#L31\" rel=\"#L31\"><i class=\"icon-link\"><\/i> 31<\/a>\n<a id=\"L32\" href=\"#L32\" rel=\"#L32\"><i class=\"icon-link\"><\/i> 32<\/a>\n<a id=\"L33\" href=\"#L33\" rel=\"#L33\"><i class=\"icon-link\"><\/i> 33<\/a>\n<a id=\"L34\" href=\"#L34\" rel=\"#L34\"><i class=\"icon-link\"><\/i> 34<\/a>\n<a id=\"L35\" href=\"#L35\" rel=\"#L35\"><i class=\"icon-link\"><\/i> 35<\/a>\n<a id=\"L36\" href=\"#L36\" rel=\"#L36\"><i class=\"icon-link\"><\/i> 36<\/a>\n<a id=\"L37\" href=\"#L37\" rel=\"#L37\"><i class=\"icon-link\"><\/i> 37<\/a>\n<a id=\"L38\" href=\"#L38\" rel=\"#L38\"><i class=\"icon-link\"><\/i> 38<\/a>\n<a id=\"L39\" href=\"#L39\" rel=\"#L39\"><i class=\"icon-link\"><\/i> 39<\/a>\n<a id=\"L40\" href=\"#L40\" rel=\"#L40\"><i class=\"icon-link\"><\/i> 40<\/a>\n<a id=\"L41\" href=\"#L41\" rel=\"#L41\"><i class=\"icon-link\"><\/i> 41<\/a>\n<a id=\"L42\" href=\"#L42\" rel=\"#L42\"><i class=\"icon-link\"><\/i> 42<\/a>\n<a id=\"L43\" href=\"#L43\" rel=\"#L43\"><i class=\"icon-link\"><\/i> 43<\/a>\n<a id=\"L44\" href=\"#L44\" rel=\"#L44\"><i class=\"icon-link\"><\/i> 44<\/a><\/pre><\/td><td><div class=\"highlight\"><pre><div id=\"LC1\" class=\"line\"><span class=\"kn\">package<\/span> <span class=\"n\">com<\/span><span class=\"o\">.<\/span><span class=\"na\">jjzhk<\/span><span class=\"o\">.<\/span><span class=\"na\">NIOPractice<\/span><span class=\"o\">.<\/span><span class=\"na\">MultiSelector<\/span><span class=\"o\">;<\/span><\/div><div id=\"LC2\" class=\"line\"><br/><\/div><div id=\"LC3\" class=\"line\"><span class=\"kn\">import<\/span> <span class=\"nn\">java.io.IOException<\/span><span class=\"o\">;<\/span><\/div><div id=\"LC4\" class=\"line\"><span class=\"kn\">import<\/span> <span class=\"nn\">java.nio.ByteBuffer<\/span><span class=\"o\">;<\/span><\/div><div id=\"LC5\" class=\"line\"><span class=\"kn\">import<\/span> <span class=\"nn\">java.nio.channels.CancelledKeyException<\/span><span class=\"o\">;<\/span><\/div><div id=\"LC6\" class=\"line\"><span class=\"kn\">import<\/span> <span class=\"nn\">java.nio.channels.SelectionKey<\/span><span class=\"o\">;<\/span><\/div><div id=\"LC7\" class=\"line\"><span class=\"kn\">import<\/span> <span class=\"nn\">java.nio.channels.Selector<\/span><span class=\"o\">;<\/span><\/div><div id=\"LC8\" class=\"line\"><span class=\"kn\">import<\/span> <span class=\"nn\">java.nio.channels.ServerSocketChannel<\/span><span class=\"o\">;<\/span><\/div><div id=\"LC9\" class=\"line\"><span class=\"kn\">import<\/span> <span class=\"nn\">java.nio.channels.SocketChannel<\/span><span class=\"o\">;<\/span><\/div><div id=\"LC10\" class=\"line\"><span class=\"kn\">import<\/span> <span class=\"nn\">java.util.Iterator<\/span><span class=\"o\">;<\/span><\/div><div id=\"LC11\" class=\"line\"><span class=\"kn\">import<\/span> <span class=\"nn\">java.util.Set<\/span><span class=\"o\">;<\/span><\/div><div id=\"LC12\" class=\"line\"><br/><\/div><div id=\"LC13\" class=\"line\"><span class=\"kn\">import<\/span> <span class=\"nn\">org.apache.log4j.Logger<\/span><span class=\"o\">;<\/span><\/div><div id=\"LC14\" class=\"line\"><br/><\/div><div id=\"LC15\" class=\"line\"><span class=\"kd\">public<\/span> <span class=\"kd\">class<\/span> <span class=\"nc\">SocketReadHandler<\/span> <span class=\"kd\">extends<\/span> <span class=\"n\">SocketHandler<\/span><span class=\"o\">{<\/span><\/div><div id=\"LC16\" class=\"line\">	<span class=\"kd\">static<\/span> <span class=\"n\">Logger<\/span> <span class=\"n\">logger<\/span> <span class=\"o\">=<\/span> <span class=\"n\">Logger<\/span><span class=\"o\">.<\/span><span class=\"na\">getLogger<\/span><span class=\"o\">(<\/span><span class=\"n\">SocketReadHandler<\/span><span class=\"o\">.<\/span><span class=\"na\">class<\/span><span class=\"o\">);<\/span><\/div><div id=\"LC17\" class=\"line\">	<span class=\"kd\">private<\/span> <span class=\"n\">SelectionKey<\/span> <span class=\"n\">selectionKey<\/span><span class=\"o\">;<\/span><\/div><div id=\"LC18\" class=\"line\">	<span class=\"kd\">private<\/span>  <span class=\"kt\">int<\/span> <span class=\"n\">BLOCK<\/span> <span class=\"o\">=<\/span> <span class=\"mi\">4096<\/span><span class=\"o\">;<\/span>    <\/div><div id=\"LC19\" class=\"line\">	<span class=\"kd\">private<\/span>  <span class=\"n\">ByteBuffer<\/span> <span class=\"n\">receivebuffer<\/span> <span class=\"o\">=<\/span> <span class=\"n\">ByteBuffer<\/span><span class=\"o\">.<\/span><span class=\"na\">allocate<\/span><span class=\"o\">(<\/span><span class=\"n\">BLOCK<\/span><span class=\"o\">);<\/span>  <\/div><div id=\"LC20\" class=\"line\">	<\/div><div id=\"LC21\" class=\"line\">	<span class=\"kd\">public<\/span> <span class=\"nf\">SocketReadHandler<\/span><span class=\"o\">(<\/span><span class=\"n\">ServerDispatcher<\/span> <span class=\"n\">dispatcher<\/span><span class=\"o\">,<\/span> <span class=\"n\">ServerSocketChannel<\/span> <span class=\"n\">sc<\/span><span class=\"o\">,<\/span> <span class=\"n\">Selector<\/span> <span class=\"n\">selector<\/span><span class=\"o\">)<\/span> <span class=\"kd\">throws<\/span> <span class=\"n\">IOException<\/span><span class=\"o\">{<\/span><\/div><div id=\"LC22\" class=\"line\">		<span class=\"kd\">super<\/span><span class=\"o\">(<\/span><span class=\"n\">dispatcher<\/span><span class=\"o\">,<\/span> <span class=\"n\">sc<\/span><span class=\"o\">,<\/span> <span class=\"n\">selector<\/span><span class=\"o\">);<\/span><\/div><div id=\"LC23\" class=\"line\">	<span class=\"o\">}<\/span><\/div><div id=\"LC24\" class=\"line\">	<\/div><div id=\"LC25\" class=\"line\">	<span class=\"nd\">@Override<\/span><\/div><div id=\"LC26\" class=\"line\">	<span class=\"kd\">public<\/span> <span class=\"kt\">void<\/span> <span class=\"nf\">runnerExecute<\/span><span class=\"o\">(<\/span><span class=\"kt\">int<\/span> <span class=\"n\">readyKeyOps<\/span><span class=\"o\">)<\/span> <span class=\"kd\">throws<\/span> <span class=\"n\">IOException<\/span> <span class=\"o\">{<\/span><\/div><div id=\"LC27\" class=\"line\">		<span class=\"c1\">// TODO Auto-generated method stub<\/span><\/div><div id=\"LC28\" class=\"line\">		<span class=\"kt\">int<\/span> <span class=\"n\">count<\/span> <span class=\"o\">=<\/span> <span class=\"mi\">0<\/span><span class=\"o\">;<\/span><\/div><div id=\"LC29\" class=\"line\">		<span class=\"k\">if<\/span> <span class=\"o\">(<\/span><span class=\"n\">SelectionKey<\/span><span class=\"o\">.<\/span><span class=\"na\">OP_READ<\/span> <span class=\"o\">==<\/span> <span class=\"n\">readyKeyOps<\/span><span class=\"o\">)<\/span><\/div><div id=\"LC30\" class=\"line\">		<span class=\"o\">{<\/span><\/div><div id=\"LC31\" class=\"line\">            <span class=\"n\">receivebuffer<\/span><span class=\"o\">.<\/span><span class=\"na\">clear<\/span><span class=\"o\">();<\/span><\/div><div id=\"LC32\" class=\"line\">            <span class=\"n\">count<\/span> <span class=\"o\">=<\/span> <span class=\"n\">socketChannel<\/span><span class=\"o\">.<\/span><span class=\"na\">read<\/span><span class=\"o\">(<\/span><span class=\"n\">receivebuffer<\/span><span class=\"o\">);<\/span>   <\/div><div id=\"LC33\" class=\"line\">            <span class=\"k\">if<\/span> <span class=\"o\">(<\/span><span class=\"n\">count<\/span> <span class=\"o\">&gt;<\/span> <span class=\"mi\">0<\/span><span class=\"o\">)<\/span> <span class=\"o\">{<\/span>  <\/div><div id=\"LC34\" class=\"line\">            	<span class=\"n\">logger<\/span><span class=\"o\">.<\/span><span class=\"na\">debug<\/span><span class=\"o\">(<\/span><span class=\"s\">&quot;Server : Readable.&quot;<\/span><span class=\"o\">);<\/span>  <\/div><div id=\"LC35\" class=\"line\">            	<span class=\"n\">receivebuffer<\/span><span class=\"o\">.<\/span><span class=\"na\">flip<\/span><span class=\"o\">();<\/span>  <\/div><div id=\"LC36\" class=\"line\">	            <span class=\"kt\">byte<\/span><span class=\"o\">[]<\/span> <span class=\"n\">bytes<\/span> <span class=\"o\">=<\/span> <span class=\"k\">new<\/span> <span class=\"kt\">byte<\/span><span class=\"o\">[<\/span><span class=\"n\">receivebuffer<\/span><span class=\"o\">.<\/span><span class=\"na\">remaining<\/span><span class=\"o\">()];<\/span><\/div><div id=\"LC37\" class=\"line\">	            <span class=\"n\">receivebuffer<\/span><span class=\"o\">.<\/span><span class=\"na\">get<\/span><span class=\"o\">(<\/span><span class=\"n\">bytes<\/span><span class=\"o\">);<\/span><\/div><div id=\"LC38\" class=\"line\">	            <span class=\"n\">String<\/span> <span class=\"n\">body<\/span> <span class=\"o\">=<\/span> <span class=\"k\">new<\/span> <span class=\"n\">String<\/span><span class=\"o\">(<\/span><span class=\"n\">bytes<\/span><span class=\"o\">,<\/span> <span class=\"s\">&quot;UTF-8&quot;<\/span><span class=\"o\">);<\/span> <\/div><div id=\"LC39\" class=\"line\">	            <span class=\"n\">logger<\/span><span class=\"o\">.<\/span><span class=\"na\">debug<\/span><span class=\"o\">(<\/span><span class=\"s\">&quot;Server : Receive :&quot;<\/span> <span class=\"o\">+<\/span> <span class=\"n\">body<\/span><span class=\"o\">);<\/span>  	            <\/div><div id=\"LC40\" class=\"line\">	            <span class=\"n\">socketChannel<\/span><span class=\"o\">.<\/span><span class=\"na\">register<\/span><span class=\"o\">(<\/span><span class=\"n\">dispatcher<\/span><span class=\"o\">.<\/span><span class=\"na\">getWriteSelector<\/span><span class=\"o\">(),<\/span> <span class=\"n\">SelectionKey<\/span><span class=\"o\">.<\/span><span class=\"na\">OP_WRITE<\/span><span class=\"o\">);<\/span><\/div><div id=\"LC41\" class=\"line\">            <span class=\"o\">}<\/span>  <\/div><div id=\"LC42\" class=\"line\">		<span class=\"o\">}<\/span><\/div><div id=\"LC43\" class=\"line\">	<span class=\"o\">}<\/span><\/div><div id=\"LC44\" class=\"line\"><span class=\"o\">}<\/span><\/div><\/pre><\/div><\/td><\/tr><\/table>\n<\/div>\n<\/div>\n<script>\n  //<![CDATA[\n    $(function(){\n      $(\'.line_numbers\').css({\'width\':\'auto\'});\n    })\n  //]]>\n<\/script>\n\n<\/div>\n<h5 class=\'clearfix\'>\n<a class=\'to_CODE\' href=\'https://code.csdn.net/snippets/475459\' target=\'_blank\'>\n<span class=\'icon\'><\/span>\n来自CODE的代码片\n<\/a>\n<div class=\'pull-right\'>\n<span>\nSocketReadHandler.java\n<\/span>\n<\/div>\n<\/h5>\n<\/div>\n");

